CREATE TABLE BANKBOOK
   ( UNAME NVARCHAR(10), UMONEY INT, CONSTRAINT CK_MONEY CHECK(UMONEY>=0) );   -- CHECK - BEGIN TRY - BEGIN CATCH는 한 세트!!로 기억해두자 
 GO

BEGIN TRAN 
    UPDATE BANKBOOK SET UMONEY = UMONEY-600 WHERE UNAME=N'구매자';
    UPDATE BANKBOOK SET UMONEY = UMONEY+600 WHERE UNAME=N'판매자';
COMMIT TRAN
-- 잘못된 결과 수행됨. 
-- 제약조건 CHECK( CK_MONEY>=0) 의 논리적 오류는 롤백이 되지 않아서 생기는 문제.  제약 조건 오류 발생시에는 강제 롤백 해줘야 함. 

  BEGIN TRY 
     BEGIN TRAN      
	   UPDATE BANKBOOK SET UMONEY = UMONEY-600 WHERE UNAME=N'구매자';
       UPDATE BANKBOOK SET UMONEY = UMONEY+600 WHERE UNAME=N'판매자';
     COMMIT TRAN 
  END TRY 
  BEGIN CATCH
     ROLLBACK TRAN 
  END CATCH 
  
  SELECT * FROM BANKBOOK   -- 첫번째 UPDATE에서 오류가 발생되었으므로, CATCH의 ROLLBACK TRAN 이 실행되어서 전체 트랜재션이 롤백된 결과. (THAT'S WHAT I WANT)